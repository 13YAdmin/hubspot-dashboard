name: Agent Publishing/Operations

on:
  schedule:
    # Toutes les 2 heures - Maintenir documentation synchronisÃ©e
    - cron: '0 */2 * * *'
  workflow_dispatch:  # Permet exÃ©cution manuelle

jobs:
  publishing:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Create communication directory
        run: mkdir -p .github/agents-communication

      - name: Run Agent Publishing
        run: |
          echo "ðŸ“° Agent Publishing/Operations - Directeur des OpÃ©rations"
          echo "=========================================================="
          echo ""
          node .github/scripts/autonomous-agents/agent-publishing.js

      - name: Commit documentation updates
        run: |
          git config --local user.email "agent-publishing@hubspot-dashboard.com"
          git config --local user.name "Agent Publishing"

          git add README.md SOCIÃ‰TÃ‰-AUTONOME.md STATUS-AUTO.md .github/agents-communication/publishing-metrics.json || true

          if git diff --staged --quiet; then
            echo "Aucune mise Ã  jour de documentation nÃ©cessaire"
          else
            git commit -m "ðŸ“° Auto-update: Documentation synchronized by Agent Publishing

Generated by Agent Publishing (Directeur des OpÃ©rations)
- README.md updated
- Org chart synchronized
- Status report generated

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"
            git push
            echo "âœ… Documentation mise Ã  jour et publiÃ©e"
          fi

      - name: Generate workflow summary
        if: always()
        run: |
          echo "## ðŸ“° Agent Publishing - Rapport" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Date**: $(date)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          if [ -f ".github/agents-communication/publishing-metrics.json" ]; then
            echo "### ðŸ“Š MÃ©triques" >> $GITHUB_STEP_SUMMARY
            echo '```json' >> $GITHUB_STEP_SUMMARY
            cat .github/agents-communication/publishing-metrics.json >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
          fi

          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âœ… Publication terminÃ©e" >> $GITHUB_STEP_SUMMARY
